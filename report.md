#WADB文档
##综述
我们的大作业项目的名称是WADB。以下从“运行概述”，“系统结构设计”，“系统功能”，“主要模块设计原理”，“实验结果”，“小组分工”等几个方面介绍我们的项目。
##运行概述
操作系统：ubuntu, Mac OSX

使用方式：详见工程目录下的readme.md文件
##系统结构设计
系统结构可以分为三部分，分别是：前端输入的接收，命令的解析，后台访问页式文件系统。

- 前端
	- 前端主要是接收用户输入的查询解析模块和系统管理模块中用到的语句。运行程序后，前端会维护一个命令行交互界面，用户可以用键盘输入命令。
	- 我们使用了lex/yacc编译框架进行命令的解析。接收到用户输入的命令后，通过yacc语法分析器进行语法分析。进行语法分析的过程中，调用lex词法分析器解析关键词，并根据这些关键词组成的表达式是否正确来判断用户输入的命令是否有语法错误。这样可以方便的对命令之间的空格进行处理，尽可能维护系统的鲁棒性。若有语法错误，将会在命令行中输出“syntax error”。无语法错误将会获得一系列关键词供下一阶段使用。

- 解析
	- 上一阶段获得了用户输入的sql语句中的关键词。这一阶段的任务是解析命令，可以通过关键词来方便的决定进行何种命令的解析。
	- 有关系统解析模块的命令，由于涉及到文件的新建、删除等操作，我们在工程根目录中设置了文件夹“database”，用于保存所有的数据库（用子文件夹表示）已经其中的表（用文本文件表示）。根据相关关键词进行操作即可。对于查询解析模块的命令，其中涉及到了四则运算，我们的处理方法是使用栈结构进行处理。
	- 以上关于命令的解析可以获得我们接下来需要进行的操作。这些操作需要使用下一阶段提供的接口。

- 后台
	- 我们在老师给出页式文件系统的基础上，实现了对具体文件（即表）的操作接口供解析阶段使用。这些接口具体有： ****
##系统功能
分为基础功能和拓展功能。

- 基础功能：实现了“数据库大作业详细说明.docx”中的所有基础语句。
- 拓展功能：实现了：
	- 域完整性约束
	- 外键约束
	- 三表连接
	- 聚集查询
	- 分组聚集查询
- 备注：基础功能中的“选择当前数据库”命令，“详细说明.docx”和“测试用例.docx”中的命令不一样，因此我们的项目使用的语句格式是

		use database dbName
即和“详细说明.docx”一致。

##主要模块设计原理
我们的项目按照大作业说明中的三个模块进行设计。其中查询解析模块和系统管理模块我们归为了一个模块。

- 查询解析模块和系统管理模块

	这两个模块都是接收到用户输入的命令后进行解析，并进行相应操作。我们使用了lex/yacc框架将用户输入的命令解析为关键词，根据关键词进行相应的操作。详见工程根目录下的"lex.l"和“yacc.y”文件。

- 记录管理模块

	该模块负责管理具体记录在文件中存储的方式，包括将表的格式及数据页信息在首页中存储，对记录进行插入、更新、删除操作等，同时还提供根据属性值寻找记录的接口。首页的安排可以见RecordManagement文件夹中的README.md文件。其中还提供了testfilesystem.cpp文件，用来对单独的模块进行测试。

##实验结果
我们创建了orderDB和winsen这两个数据库，其中orderDB里存有老师给的数据集中的四个表：book,customer,orders,publisher。这是我们向助教展示的时候使用的数据集。
winsen里的表是我们平时自己调试时创建的。
我们根据测试要求准确地完成了所有基础要求和部分拓展功能，实验结果的正确性已经在当面检查过程中确认过。

##小组分工
- 大部分基础和拓展功能都是两人讨论后合作编程得到的。
- 王苏主要负责系统管理模块和查询解析模块，编写lex/yacc框架实现与用户交互的命令行界面，进行对命令行输入的sql语句的解释分析，转换为关系代数表达式，生成查询计划后调用王豪编写的接口进行具体的操作，用栈来实现四则运算表达式。
- 王豪主要负责：记录管理模块的编码，接口的设计，包括插入、删除、更新记录的函数，根据属性值返回记录Rid等接口。同时还有具体记录在文件中存储的形式、页式文件系统的使用，重点和难点是能够将每一页的缓存指针调整无误。同时还编写了testfilesystem.cpp文件，用来对单独的记录管理模块进行测试，便于和其他模块同步编码。

##参考文献
- lex/yacc框架的搭建和使用：http://blog.csdn.net/huyansoft/article/details/8860224
- 文件夹的删除操作：http://blog.163.com/result_2205/blog/static/139819450201021772753884/
- 我们工程的git网址:https://github.com/AnthonyWang14/DB_prj
